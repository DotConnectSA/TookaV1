@model RealEstateV1.Models.T_Town

@{
    ViewBag.Title = "TownInformation";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@*@Html.Partial("_SearchBar", new RealEstateV1.Busniss.SearchItem())*@

<div style="position:absolute;left:50%;top:85px;">

    @Html.DropDownList("City", (SelectList)ViewBag.Cites)
    @Html.DropDownList("town", (SelectList)ViewBag.town)
</div>

<h2>معلومات محلية</h2>

@*<table class="table" >
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.TownName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Description)
            </th>
            <th></th>
        </tr>
    </table>*@


<div id="container">
    <div class="row">

        <ul class="list col-lg-9 col-sm-7" id="list">

            @if (Model == null)
            {
                <li>
                    لايوجد بيانات
                </li>
            }
            else
            {
                //foreach (var item in Model)
                //{
                foreach (var it in Model.Comment)
                {
                    @Html.Partial("_TownPartial", it);
                }
                @*}*@
            }

        </ul>

        <div id="work"></div>


        <aside class="left-col list col-lg-3 col-sm-5">
            <div class="block ads">

                <div class="content">
                    <a href="#">
                        <img src="@Url.Content("~/Content/images/ad1.jpg")" />
                    </a>
                </div>
            </div>
            <div class="block ads">

                <div class="content">
                    <a href="#">
                        <img src="@Url.Content("~/Content/images/ad2.jpg")" />
                    </a>
                </div>
            </div>

            <div class="block blue">
                <h3>عقارات قريبة</h3>
                <div class="content">
                    <ul>
                        @for (int i = 0; i < 2; i++)
                        {
                            @Html.Partial("_miniRE")
                        }
                    </ul>
                </div>
            </div>


        </aside>
        <div class="clear"></div>

    </div>
</div>


<script type="text/javascript">

    function getComm(Commnet) {
        $.ajax({
            cache: false,
            type: "POST",
            url: "@(Url.Action("GetComment"))",
            data: { "CommentID": Commnet },
            success: function (data) {
                $("#list").append(data);
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert('Failed to retrieve states. ' + xhr + " - " + ajaxOptions + " - " + thrownError);

            }
        });
    }

    function getTownComm(town) {
        var town1 = town;
        $.ajax({
            cache: false,
            type: "POST",
            url: "@(Url.Action("GetTowninfo"))",
            data: { "townID": town1 },
            success: function (data) {

                $("#list").html('');

                $.each(data, function (id, Comment) {
                    getComm(Comment.ID);
                });
                alert(result);
                $("#list").html(result);

            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert('Failed to retrieve states. ' + xhr + " - " + ajaxOptions + " - " + thrownError);

            }
        });
    }

    $(function () {

        $("#City").change(function () {
            var selection = $(this).val();
            var ddtown = $("#town");
            $.ajax({
                cache: false,
                type: "POST",
                url: "@(Url.Action("GetTown"))",
                data: { "CityID": selection },
                success: function (data) {
                    ddtown.html('');
                    $("#list").html('');
                    $.each(data, function (id, option) {
                        ddtown.append($('<option></option>').val(option.id).html(option.name));
                    });

                    getTownComm(data[0].id);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Failed to retrieve states. ' + xhr + " - " + ajaxOptions + " - " + thrownError);

                }
            });
        });



        $("#town").change(function () {
            var town1 = $("#town").val();
            $.ajax({
                cache: false,
                type: "POST",
                url: "@(Url.Action("GetTowninfo"))",
                data: { "townID": town1 },
                success: function (data) {

                    $("#list").html('');

                    $.each(data, function (id, Comment) {
                        getComm(Comment.ID);
                    });
                    alert(result);
                    $("#list").html(result);

                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Failed to retrieve states. ' + xhr + " - " + ajaxOptions + " - " + thrownError);

                }
            });
        });

    });
</script>
